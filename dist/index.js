(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Rein=b()})(this,function(){"use strict";function a(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function b(a,b){return b={exports:{}},a(b,b.exports),b.exports}var c="undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?{}:self:global:window,d=b(function(a,b){function c(a){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function d(a){return null!==a&&"object"==typeof a}function e(a){return"undefined"!=typeof FormData&&a instanceof FormData}function f(a){return"[object File]"===toString.call(a)}function g(a){return"undefined"!=typeof URLSearchParams&&a instanceof URLSearchParams}function h(a){return"[object Date]"===Object.prototype.toString.call(a)}function i(a,b,c){var d=a;return d.config=c,d.response=b,d.isFetchError=!0,d.toJSON=function(){return{message:this.message,name:this.name,stack:this.stack,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,config:this.config}},d}function j(a){return /^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(a)}function k(a){var b=[];return Object.keys(a).forEach(function(e){var f=a[e];null==f||(Array.isArray(f)?e+="[]":f=[f],f.forEach(function(a){h(a)?a=a.toISOString():d(a)&&(a=JSON.stringify(a)),b.push(c(e)+"="+c(a))}))}),b.join("&")}function l(){function a(a,b){d[b]="object"==typeof a?"object"==typeof d[b]?l(d[b],a):l({},a):a}for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];var d={};return b.forEach(function(b){Object.keys(b).forEach(function(c){a(b[c],c)})}),d}b.__esModule=!0,b.isObject=d,b.isFormData=e,b.isFile=f,b.isURLSearchParams=g,b.isDate=h,b.parseHeaders=function(a){var b={};return"undefined"!=typeof Headers&&a instanceof Headers&&"function"==typeof a.forEach&&a.forEach(function(a,c){b[a]=c}),b},b.enrichErrorData=i,b.createError=function(a,b,c){var d=new Error(a);return i(d,b,c)},b.buildUrl=function(a,b,c,d,e){return void 0===b&&(b="/"),j(c)||(c=a.replace(/\/+$/,"")+"/"+b.replace(/\/+$/,"").replace(/^\/+/,"")+"/"+c.replace(/^\/+/,"")),d&&null!=e&&Object.keys(e).forEach(function(a){c=c.replace(new RegExp("\\{"+a+"\\}"),e[a]+"")}),c},b.transformData=function(a,b,c){var d=this;void 0===a&&(a={}),void 0===b&&(b={}),c.forEach(function(c){"function"==typeof c&&c.call(d,a,b)})},b.addQuery=function(a,b){if(null==b||!Object.keys(b).length)return a;var c=k(b);return a+=-1<a.indexOf("?")?"&"+c:"?"+c,a},b.parseData=function(a){return e(a)||f(a)||g(a)?a:d(a)?JSON.stringify(a):a},b.merge=l});a(d);var e=d.isObject,f=d.isFormData,g=d.isFile,h=d.isURLSearchParams,i=d.isDate,j=d.parseHeaders,k=d.enrichErrorData,l=d.createError,m=d.buildUrl,n=d.transformData,o=d.addQuery,p=d.parseData,q=d.merge,r=b(function(a,b){b.__esModule=!0;var c;(function(a){a.GET="GET",a.HEAD="HEAD",a.DELETE="DELETE",a.OPTIONS="OPTIONS",a.POST="POST",a.PUT="PUT",a.PATCH="PATCH"})(c=b.MethodNames||(b.MethodNames={}));var d=function(){function a(){}return a.prototype.apply=function(){throw new Error("must implement apply method.")},a}();b.BaseAdaptor=d});a(r);var s=r.MethodNames,t=r.BaseAdaptor,u=b(function(a,b){var e=c&&c.__extends||function(){var a=function(c,d){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var b in c)c.hasOwnProperty(b)&&(a[b]=c[b])},a(c,d)};return function(c,d){function b(){this.constructor=c}a(c,d),c.prototype=null===d?Object.create(d):(b.prototype=d.prototype,new b)}}(),f=c&&c.__assign||function(){return f=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a},f.apply(this,arguments)};b.__esModule=!0;var g={validateResponse:function(a){var b=a.status;return!!(200<=b&&300>b)}},h={method:"GET",mode:"cors",credentials:"include",cache:"no-cache",redirect:"follow",referrerPolicy:"no-referrer-when-downgrade"},i=function(){var a=[{match:function(a){return"method"===a},action:function(a,b){b.method=a.method?a.method.toUpperCase():"GET"}},{match:function(a){return"data"===a},action:function(a,b){var c=a.method||b.method;-1===["GET","HEAD"].indexOf(c.toUpperCase())&&(b.body=a.data)}},{match:function(a){return-1<["headers","mode","credentials","cache","redirect","referrer","referrerPolicy","keepalive","integrity"].indexOf(a)},action:function(a,b,c){b[c]=a[c]}}];return function(b,c){var d=this;Object.keys(b).forEach(function(e){for(var f,g=0;g<a.length;g++)if(f=a[g],f.match(e))return f.action.call(d,b,c,e)})}}(),j=function(a){function b(b,c){void 0===b&&(b={}),void 0===c&&(c={});var d=a.call(this)||this;if(d.config=f({},g,b),d.debug=d.config.debug||!1,d.defaultInit=f({},h,c),d.debug&&console.info("[rein-api]: The config of AdaptorFetch is ",b),!d.isSupportFetch())throw new Error("[AdaptorFetch]: does not support fetch api.");return d}return e(b,a),b.prototype.isSupportFetch=function(){return"undefined"!=typeof window.fetch},b.prototype.apply=function(a){var b=this,c=f({},this.defaultInit);i.call(this,a,c);var e=c;return this.debug&&console.info("[rein-api]: The init of AdaptorFetch.apply is ",c),window.fetch(a.url,e).then(function(b){var c={status:b.status,statusText:b.statusText,headers:d.parseHeaders(b.headers),config:a,init:e},f={};return f="ok"===b.statusText.toLowerCase()?b.json():b.text(),Promise.all([f,Promise.resolve(c)])}).then(function(c){var e=c[0],g=c[1],h=f({data:e},g);if(b.config.validateResponse(h))return Promise.resolve(h);var i=d.createError("Request failed with status code "+h.status,h,a);return Promise.reject(i)})},b}(r.BaseAdaptor);b["default"]=j});a(u);var v=b(function(a,b){b.__esModule=!0;var c=function(){function a(){this.handlers=[]}return a.prototype.use=function(a,b){return this.handlers.push({fulfilled:a,rejected:b}),this.handlers.length-1},a.prototype.eject=function(a){a<this.handlers.length&&-1<a&&(this.handlers[a]=null)},a.prototype.forEach=function(a){this.handlers.forEach(function(b){if(null!=b)try{a(b)}catch(a){console.error("[InterceptorManager error]: ",a)}})},a}();b["default"]=c});a(v);var w=b(function(a,b){var e=c&&c.__assign||function(){return e=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a},e.apply(this,arguments)};b.__esModule=!0;var f={dispatchConfig:{baseUrl:window.location.origin,headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"}},transformRequest:[function(a,b){return d.isFormData(a)||d.isFile(a)?a:d.isURLSearchParams(a)?(!!b&&b["Content-Type"]&&(b["Content-Type"]="application/x-www-form-urlencoded"),a.toString()):d.isObject(a)?(!!b&&b["Content-Type"]&&(b["Content-Type"]="application/json"),JSON.stringify(a)):a}],transformResponse:[function(a){try{"string"==typeof a&&(a=JSON.parse(a))}catch(a){}return a}]},dispatchOption:{method:"GET",url:"/",restful:!1,prefix:"/",meta:{},params:{},data:{},resource:{}}},g=["common"].concat(Object.keys(r.MethodNames).map(function(a){return a.toLowerCase()})),h=function(){function a(a,b){this.config=e({},f.dispatchConfig,a),this.config.headers=d.merge({},a.headers||{},f.dispatchConfig.headers),this.debug=this.config.debug||!1,this.adaptor=b,this.dispatch=this.dispatch.bind(this)}return a.prototype.dispatch=function(a){a=d.merge({},f.dispatchOption,a),this.debug&&console.info("[rein-api]: The option of DispatchRequest.dispatch is ",a);var b=this.config,c=b.baseUrl,h=b.defaultPrefix,i=void 0===h?"/":h,j=b.headers,k=b.transformRequest,l=b.transformResponse,m=a.method,n=a.resource,o=a.data,p=a.url,q=a.restful,r=a.prefix,s=void 0===r?"/":r,t=a.params,u=d.buildUrl(c,s||i,p,q,n);u=d.addQuery(u,t),d.transformData(o,j,k);var v=d.parseData(o),w=e({},j.common||{},j[m]||{},j);return g.forEach(function(a){delete w[a]}),this.adaptor.apply({url:u,method:m,data:v,headers:w}).then(function(a){d.transformData(a.data,a.headers,l);var b=d.merge(Object.create(null),a.data);return Promise.resolve(b)},function(a){return d.transformData(a.response.data,a.response.headers,l),Promise.reject(a)})},a}();b["default"]=h});a(w);var x=b(function(a,b){b.__esModule=!0;var c=function(){function a(a,b){this.debug=a.debug||!1,this.debug&&console.info("[rein-api]: The config of Rein is ",a),this.adaptor=b||new u["default"]({debug:this.debug}),this.interceptors={request:new v["default"],response:new v["default"]},this.dispatcher=new w["default"](a,this.adaptor),this.request=this.request.bind(this)}return a.prototype.request=function(a){this.debug&&console.info("[rein-api]: The options of Rein.request is ",a);var b=Promise.resolve(a),c=this.dispatcher.dispatch,d=[c,void 0];for(this.interceptors.request.forEach(function(a){d.unshift(a.fulfilled,a.rejected)}),this.interceptors.response.forEach(function(a){d.push(a.fulfilled,a.rejected)});d.length;)b=b.then(d.shift(),d.shift());return b},a}();b["default"]=c}),y=a(x);return y});
